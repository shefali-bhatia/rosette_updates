#lang rosette 
 
(require "../cosette.rkt" "../util.rkt" "../denotation.rkt" "../cosette.rkt" "../sql.rkt" "../evaluator.rkt" "../syntax.rkt" "../symmetry.rkt" "../test-util.rkt") 
  

(provide ros-instance)  

(current-bitwidth #f)

(define t0 (table-info "input" (list "Id" "crit1" "crit2" "value")))
 
(define (q5 tables) 
(SELECT (VALS "t6.crit11" "t6.crit2" "t6.value" )
 FROM (AS (JOIN (AS (SELECT (VALS "t3.crit1" (VAL-UNOP aggr-max (val-column-ref "t3.crit2")) )
 FROM (AS (SELECT (VALS "input.Id" "input.crit1" "input.crit2" "input.value" )
 FROM (NAMED (list-ref tables 0))
 WHERE (AND (TRUE) (BINOP "input.Id" >= "input.crit2"))) ["t3" (list "Id" "crit1" "crit2" "value")])
 WHERE (TRUE)
 GROUP-BY (list "t3.crit1" )
 HAVING (TRUE)) ["t4" (list "crit1" "max_crit2")]) (AS (NAMED (list-ref tables 0)) ["t5" (list "Id" "crit1" "crit2" "value")])) ["t6" (list "crit1" "max_crit2" "Id" "crit11" "crit2" "value")])
 WHERE (AND (BINOP "t6.crit1" (lambda (x y) (not (equal? x y))) "t6.crit11") (BINOP "t6.max_crit2" <= "t6.Id"))))
 
(define (q4 tables) 
(SELECT (VALS "t4.crit1" "t4.crit21" "t4.value" )
 FROM (AS (JOIN (AS (SELECT (VALS "t3.crit2" (VAL-UNOP aggr-max (val-column-ref "t3.crit1")) )
 FROM (AS (SELECT (VALS "input.Id" "input.crit1" "input.crit2" "input.value" )
 FROM (NAMED (list-ref tables 0))
 WHERE (AND (BINOP "input.Id" <= "input.crit2") (TRUE))) ["t3" (list "Id" "crit1" "crit2" "value")])
 WHERE (TRUE)
 GROUP-BY (list "t3.crit2" )
 HAVING (TRUE)) ["t6" (list "crit2" "max_crit1")]) (AS (NAMED (list-ref tables 0)) ["t5" (list "Id" "crit1" "crit2" "value")])) ["t4" (list "crit2" "max_crit1" "Id" "crit1" "crit21" "value")])
 WHERE (AND (BINOP "t4.max_crit1" (lambda (x y) (not (equal? x y))) "t4.crit1") (BINOP "t4.crit2" <= "t4.Id"))))
 
(define (q3 tables) 
(SELECT (VALS "t6.crit11" "t6.crit2" "t6.value" )
 FROM (AS (JOIN (AS (SELECT (VALS "t3.crit1" (VAL-UNOP aggr-max (val-column-ref "t3.crit2")) )
 FROM (AS (SELECT (VALS "input.Id" "input.crit1" "input.crit2" "input.value" )
 FROM (NAMED (list-ref tables 0))
 WHERE (AND (BINOP "input.Id" <= "input.crit2") (TRUE))) ["t3" (list "Id" "crit1" "crit2" "value")])
 WHERE (TRUE)
 GROUP-BY (list "t3.crit1" )
 HAVING (TRUE)) ["t4" (list "crit1" "max_crit2")]) (AS (NAMED (list-ref tables 0)) ["t5" (list "Id" "crit1" "crit2" "value")])) ["t6" (list "crit1" "max_crit2" "Id" "crit11" "crit2" "value")])
 WHERE (AND (BINOP "t6.crit1" (lambda (x y) (not (equal? x y))) "t6.crit11") (BINOP "t6.max_crit2" < "t6.Id"))))
 
(define (q2 tables) 
(SELECT (VALS "t6.crit11" "t6.crit2" "t6.value" )
 FROM (AS (JOIN (AS (SELECT (VALS "t5.crit1" (VAL-UNOP aggr-max (val-column-ref "t5.Id")) )
 FROM (AS (SELECT (VALS "input.Id" "input.crit1" "input.crit2" "input.value" )
 FROM (NAMED (list-ref tables 0))
 WHERE (AND (BINOP "input.Id" <= "input.crit2") (TRUE))) ["t5" (list "Id" "crit1" "crit2" "value")])
 WHERE (TRUE)
 GROUP-BY (list "t5.crit1" )
 HAVING (TRUE)) ["t4" (list "crit1" "max_Id")]) (AS (NAMED (list-ref tables 0)) ["t3" (list "Id" "crit1" "crit2" "value")])) ["t6" (list "crit1" "max_Id" "Id" "crit11" "crit2" "value")])
 WHERE (AND (BINOP "t6.crit1" (lambda (x y) (not (equal? x y))) "t6.crit11") (BINOP "t6.max_Id" < "t6.Id"))))
 
(define (q1 tables) 
(SELECT (VALS "t6.crit11" "t6.crit2" "t6.value" )
 FROM (AS (JOIN (AS (SELECT (VALS "t3.crit1" (VAL-UNOP aggr-max (val-column-ref "t3.crit2")) )
 FROM (AS (SELECT (VALS "input.Id" "input.crit1" "input.crit2" "input.value" )
 FROM (NAMED (list-ref tables 0))
 WHERE (AND (TRUE) (BINOP "input.Id" (lambda (x y) (not (equal? x y))) "input.crit2"))) ["t3" (list "Id" "crit1" "crit2" "value")])
 WHERE (TRUE)
 GROUP-BY (list "t3.crit1" )
 HAVING (TRUE)) ["t4" (list "crit1" "max_crit2")]) (AS (NAMED (list-ref tables 0)) ["t5" (list "Id" "crit1" "crit2" "value")])) ["t6" (list "crit1" "max_crit2" "Id" "crit11" "crit2" "value")])
 WHERE (AND (BINOP "t6.crit1" = "t6.crit11") (BINOP "t6.max_crit2" < "t6.Id"))))

(define ros-instance (list q1 q2 (list t0)))
